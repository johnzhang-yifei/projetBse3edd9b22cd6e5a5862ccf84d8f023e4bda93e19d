<!DOCTYPE html>
<title>d3 | modulo operation to create a grid</title>
<style>

*{box-sizing:border-box}* body{font-family:-apple-system,BlinkMacSystemFont,Consolas,monaco,monospace;width:650px;margin:0 auto;position:relative;background:#ccc}* #value{color:#de3d83;letter-spacing:1px;font-size:72px;position:absolute;top:20px;right:20px;text-align:right}
  
  </style>
<body>
  <div>
    <div id="waffle"></div>
    <span id="value"></span>
  </div>
  <script src='https://d3js.org/d3.v4.min.js'></script>
  <script src='dist.js'></script>
  <!-- render code -->
  <script>
    const d3 = window.d3
    // render an update
    const chart = d3.waffle
    d3.interval(function () {
      let n = Math.floor(d3.randomUniform(5, 100)())
      chart('#waffle', n, {
        strokeCol: '#ccc',
        margin: {top: 35},
        squareSize: 40,
        strokeWidth: 2
      })
      d3.select('#value').html(n + '%')
    }, 1000)



    const d3 = window.d3

d3.waffle = function (bind, value = 100, config) {
  config = {
    squareCol: '#de3d83',
    squareBgd: '#e0e5db',
    strokeCol: '#fff',
    squareSize: 20,
    strokeWidth: 2,
    ...config,
    margin: {
      top: 5,
      right: 5,
      bottom: 5,
      left: 5,
      ...(config || {}).margin
    }
  }
  const { margin, squareSize, squareCol, squareBgd, strokeCol, strokeWidth } = config

  const size = (squareSize + (strokeWidth * 2)) * 10

  const selection = d3.select(bind)

  // append the svg if first render
  if (selection.select('svg').empty()) {
    selection
      .append('svg')
      .attr('width', size + margin.left + margin.right)
      .attr('height', size + margin.top + margin.bottom)
      .append('g')
      .attr('transform', `translate(${margin.left}, ${margin.top})`)
      .call(grid10by10)
  }

  function grid10by10 (sel) {
    const scale = d3.scaleLinear()
      .domain([0, 9])
      .range([0, squareSize * 10])

    const join = sel.selectAll('rect')
      .data(d3.range(100))

    join.enter().append('rect')
      .attr('x', (d, i) => {
        const n = i % 10
        return scale(n)
      })
      .attr('y', (d, i) => {
        const n = Math.floor(i / 10)
        return scale(n)
      })
      .attr('width', squareSize)
      .attr('height', squareSize)
      .attr('stroke-width', strokeWidth)
      .attr('stroke', strokeCol)
      .merge(join)
      // note < not <= as counting from 0
      .transition()
      .attr('fill', (d, i) => (i < value) ? squareCol : squareBgd)

    // join.exit().remove()
  }

  return selection.select('svg g').call(grid10by10)
}



  </script>
</body>